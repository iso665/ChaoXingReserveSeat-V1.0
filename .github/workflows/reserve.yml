name: auto_Reserve

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Set up Python 3.11
        uses: actions/setup-python@v4
        with:
          python-version: 3.11

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install cryptography requests pytz

      - name: Run script
        env:
          USERNAMES: ${{ secrets.USERNAMES }}
          PASSWORDS: ${{ secrets.PASSWORDS }}
        run: |
          python main.py -m reserve --action

      - name: Upload debug artifact if it exists
        # 这个步骤是新增加的
        # 它会检查 page_source_for_debug.html 文件是否存在
        # 如果存在（意味着脚本出错了），就把它上传
        uses: actions/upload-artifact@v3
        if: failure() # 仅在上一步（Run script）失败时运行
        with:
          name: page_source_for_debug.html
          path: page_source_for_debug.html
